from ..engine.base import DepotB7Map, WarehouseCoordinate

class UpperFloorMap(DepotB7Map):
    def __init__(self, floor_index: int = 3):
        super().__init__(width=46, height=31, floor_index=floor_index)
        self.zones = {
           "Assenseur": (2, 21, 7.3, 23.5),
           "Monte Charge 1": (29.5, 20.8, 33, 25),
           "Monte Charge 2": (33, 20.8, 36.4, 25),
           "A1":(44,22.5,45.5,30),
           "A2":(40.8,22.5,43.3,30),
           "A3":[(38.7 , 22.5, 40, 30),(37.2 , 27.4 , 38.7, 30),(36 , 28 , 37.2, 30)],
           "A4":(29.5 , 25 , 33.1 ,27.7),
           "A5":(25.2 , 28.3 , 33 , 30),
           "A6":(22.6 , 22.5 , 25.2 , 30),
           "B1":(18.2 , 22.5 , 21 , 30),
           "B2":(14.5 , 22.5 , 17.2 , 30),
           "B3":(11.1 , 22.5 , 13.8 , 30),
           "B5":(1.7 , 28.3 , 7.1 , 30),
           "B6":(0 , 22.5 , 1.7 , 30),
           "E1":(43 , 0 , 45.7 , 4.5),
           "E2":(40.5 , 0 , 43 , 4.5),
           "E3":(38 , 0 , 40.5 , 4.5),
           "E4":(35.1 , 0 , 38 , 4.5),
           "E5":(32.6 , 0 , 35.1 , 4.5),
           "E6":(30 , 0 , 32.6 , 4.5),
           "E7":(27.5 , 0 , 30 , 4.5),
           "E8":(25 , 0 , 27.5 , 4.5),
           "E9":(22.1 , 0 , 25 , 4.5),
           "E10":(19.7 , 0 , 22.1 , 4.5),
           "E11":(17 , 0 , 19.7 , 4.5),
           "E12":(14.5 , 0 , 17 , 4.5),
           "E13":(12 , 0 , 14.5 , 4.5),
           "E14":(9.2 , 0 , 12 , 4.5),
           "E15":(6.6 , 0 , 9.2 , 4.5),
           "E16":(4 , 0 , 6.6 , 4.5),
           "E17":(0 , 0 , 2.6 , 4.5),
           "C1":(44 , 13 , 45.5 , 18),
           "C7":(44 , 8.1 , 45.5 , 13),
           "C2":(40.7 , 13 , 43.2 , 18),
           "C8":(40.7 , 8.1 , 43.2 , 13),
           "C3":[(37.1 , 13 , 40 , 18),(36 , 11.5 , 37.1 , 18)],
           "C9":(37.1,8.1 , 40 , 13),
           "C4":(31.9 , 13 , 34.5 , 18),
           "C10":(31.9 , 8.1 , 34.5 , 13),
           "C5":[(30 , 13 , 31.1 , 18),(28.5 , 11.5 ,30, 18)],
           "C11":(30, 8.1 , 31.1 , 13),
           "C6":(25.1 , 13 , 28 , 18),
           "C12":[(25.1 , 8.1 , 26.5 , 13),(26.5 , 10.9 , 28 , 13 )],
           "D1":[(21 , 14.9 , 22.1 , 18), (19.5 , 13 , 21 , 18)],
           "D2":(17.2, 13, 20, 18),
           "D3":(14.5, 13, 16, 18),
           "D4":(11, 13, 14, 18),
           "D5":[(8, 13, 10.5, 18),(6.5, 11.5, 8, 18)],
           "D6":[(5 , 13 , 6 , 18),(3.5 , 11.5 , 5 , 18)],
           "D7":(0 , 13 , 1.5 , 18),
           "D8":[(19.5 , 8.1 , 21 , 13), (21 , 8.1 , 22.1 , 11.1)],
           "D9":(17.2, 8.1, 20, 13),
           "D10":(14.5, 8.1, 16, 13),
           "D11":(11, 8.1, 14, 13),
           "D12":(8, 8.1, 10.5, 13),
           "D13":(5, 8.1 , 6 , 13),
           "D14":[(0 , 8.1 , 1.4 , 13),(1.4 , 10.9 , 2.9 , 13 )],
        }
        self.pillars = [
            WarehouseCoordinate(x, y) for x, y in [
                (2,8),(7.5,8),(14,8),(21,8),(23,8),(29,8),(36,8),(43,8),
                (2,15),(7.5,15),(14,15),(21,15),(23,15),(29,15),(36,15),(43,15),
                (14,20.5),(21,20.5),(23,20.5),(43,20.5),
                (14,27),(36,27),(43,27)
            ]
        ]
        self._precompute_matrices()
        self.walkable_graph = self.build_walkable_graph()

if __name__ == "__main__":
    import matplotlib.pyplot as plt
    # Test Floor 3
    map_obj = UpperFloorMap(floor_index=3)
    print("Visualizing Floor 3...")
    map_obj.visualize()

